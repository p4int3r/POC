# 漏洞详情

## 漏洞简介

Oracle Fusion Middleware中的Oracle WebLogic Server组件的WLS Security子组件存在安全漏洞。使用精心构造的xml数据可能造成任意代码执行，攻击者只需要发送精心构造的HTTP请求，就可以拿到目标服务器的权限。攻击者可利用该漏洞控制组件，影响数据的可用性、保密性和完整性。

## 漏洞影响范围

Weblogic Server 10.3.6.0.0,
Weblogic Server 12.1.3.0.0,
Weblogic Server 12.2.1.1.0,
Weblogic Server 12.2.1.2.0

## 漏洞分析

这是XML Decoder的漏洞，以下是补丁代码：

    private void validate(InputStream is) {
        WebLogicSAXParserFactory factory = new WebLogicSAXParserFactory();
        try {
            SAXParser parser = factory.newSAXParser();
            parser.parse(is, new DefaultHandler() {
                public void startElement(String uri, String localName, String qName, Attributes attributes) throws SAXException {
                    if(qName.equalsIgnoreCase("object")) {
                        throw new IllegalStateException("Invalid context type: object");
                    }
            }
         });

      } catch (ParserConfigurationException var5) {
            throw new IllegalStateException("Parser Exception", var5);
      } catch (SAXException var6) {
         throw new IllegalStateException("Parser Exception", var6);
      } catch (IOException var7) {
         throw new IllegalStateException("Parser Exception", var7);
      }
   }

简单来说就是在解析xml的过程中，如果Element字段值为Object就抛出异常，这修复显得有些业余，所以马上有了CVE-2017-10271，前段事件分析Oracle weblogic十月份的补丁的时候看到WorkContextXmlInputAdapter相关代码时只关注了这块dos的漏洞，没看到10271添加的new,method,void的去除。因为可以通过其他方式绕过，比如典型的就是将object改为void，这是挖矿的人采用的Poc，当然也可以通过new关键字来创建反序列化执行的PoC。

## 漏洞POC

参见CVE-2017-10271

## 漏洞复现

(1) 安装受影响的Weblogic版本；

(2) 执行POC进行验证。

    python3 cve-2017-10271.py http://192.168.1.1:7001

## 修复方案

(1) 升级Oracle 10月份补丁

(2) 对访问wls-wsat的资源进行访问控制
